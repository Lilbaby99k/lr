<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GoMeal ‚Äî Dashboard</title>

  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <style>
    /* ---------- Colors & base ---------- */
    :root{
      --green: #2aa65b;        /* sidebar */
      --green-dark: #238a4a;
      --muted: #6b7280;
      --card-bg: #ffffff;
      --page-bg: #f6fbf7;
      --accent: #ffb347;
      --shadow: rgba(16,24,40,0.06);
      --radius: 12px;
      --max-width: 1200px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Poppins", Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--page-bg);
      color:#0f1724;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .container{max-width:var(--max-width);margin:18px auto;padding:16px}

    /* ---------- Top bar ---------- */
    .topbar{
      display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;
      background:linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.9));
      box-shadow:0 6px 18px var(--shadow);
    }
    .brand{font-weight:800;font-size:18px;color:var(--green-dark)}
    .top-search input{padding:10px 14px;border-radius:10px;border:1px solid rgba(15,23,36,0.06);width:280px}
    .top-actions{margin-left:auto;display:flex;gap:10px;align-items:center}
    .icon-btn{background:transparent;border:none;cursor:pointer;font-size:16px;color:var(--muted)}

    .profile-wrapper{display:flex;align-items:center;gap:8px;position:relative}
    .avatar{width:44px;height:44px;border-radius:10px;object-fit:cover;border:2px solid #fff;box-shadow:0 4px 12px rgba(0,0,0,0.06)}
    .small-ic{font-size:14px;color:var(--muted)}

    /* ---------- Layout (desktop) ---------- */
    .layout{display:grid;grid-template-columns:260px 1fr 320px;gap:18px;margin-top:18px;align-items:start}
    .sidebar{background:var(--green);color:#fff;border-radius:14px;padding:18px;height:calc(100vh - 120px);position:sticky;top:18px;box-shadow:0 8px 30px rgba(0,0,0,0.08)}
    .sidebar .profile{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    .sidebar .profile .name{font-weight:700}
    .sidebar .nav{display:flex;flex-direction:column;gap:8px;margin-top:12px}
    .nav-item{background:transparent;color:#eaf8ee;border:none;text-align:left;padding:10px 12px;border-radius:10px;cursor:pointer;display:flex;gap:10px;align-items:center}
    .nav-item.active{background:rgba(255,255,255,0.12);font-weight:700}
    .start-order{margin-top:14px;background:#fff;color:var(--green);padding:10px;border-radius:10px;border:none;cursor:pointer;width:100%;font-weight:700;box-shadow:0 6px 20px rgba(0,0,0,0.06)}

    /* ---------- Center (white card) ---------- */
    .main-card{background:var(--card-bg);border-radius:14px;padding:18px;box-shadow:0 8px 24px var(--shadow)}
    .hero{display:flex;align-items:center;gap:12px;justify-content:space-between}
    .hero h2{margin:0;font-size:20px}
    .search-large{display:flex;gap:8px}
    .search-large input{padding:10px 14px;border-radius:10px;border:1px solid rgba(15,23,36,0.06);width:420px}

    /* categories row - small cards */
    .category-row{display:flex;gap:10px;overflow:auto;padding:12px 0}
    .category-pill{background:#fff;border-radius:10px;padding:10px 14px;box-shadow:0 8px 18px rgba(16,24,40,0.04);min-width:110px;display:flex;gap:10px;align-items:center;cursor:pointer}
    .category-pill .icon{width:44px;height:44px;border-radius:8px;background:linear-gradient(180deg, rgba(0,0,0,0.03), rgba(0,0,0,0.01));display:flex;align-items:center;justify-content:center;font-size:20px;color:var(--green-dark)}

    /* cards grid (meals) */
    .meals-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:12px}
    .meal-card{background:#fff;border-radius:12px;padding:12px;box-shadow:0 8px 24px rgba(16,24,40,0.04);display:flex;flex-direction:column;gap:8px}
    .meal-card img{width:100%;height:140px;object-fit:cover;border-radius:8px}
    .meal-meta{display:flex;justify-content:space-between;align-items:center}
    .price{font-weight:700;color:var(--green-dark)}
    .add-small{background:var(--green);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}

    /* favorite restaurants / top meals section */
    .section-title{display:flex;justify-content:space-between;align-items:center;margin-top:18px}
    .cards-row{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:10px}

    /* ---------- Right panel (My Order) ---------- */
    .rightpanel{background:#fff;border-radius:14px;padding:14px;box-shadow:0 8px 24px rgba(16,24,40,0.04);height:fit-content;display:flex;flex-direction:column;gap:12px}
    .order-header{display:flex;justify-content:space-between;align-items:center}
    .order-list{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:10px;max-height:360px;overflow:auto}
    .order-item{display:flex;gap:10px;align-items:center;border-radius:10px;padding:8px;background:#f5faf3}
    .order-item img{width:56px;height:56px;border-radius:8px;object-fit:cover}
    .item-meta{flex:1}
    .item-controls{display:flex;align-items:center;gap:6px}
    .qty-btn{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:6px;border-radius:6px;cursor:pointer}
    .totals{border-top:1px solid rgba(15,23,36,0.04);padding-top:10px}
    .checkout-btn{background:var(--green);color:#fff;border:none;padding:12px;border-radius:10px;cursor:pointer;width:100%;font-weight:700}

    /* ---------- Modal (checkout receipt) ---------- */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:4000}
    .modal-backdrop.show{display:flex}
    .modal{background:#fff;border-radius:12px;padding:18px;width:96%;max-width:720px;box-shadow:0 12px 40px rgba(16,24,40,0.2)}
    .modal .modal-items{max-height:320px;overflow:auto;margin-top:10px}
    .modal .modal-row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #eee}

    /* ---------- Responsive adjustments ---------- */
    @media (max-width:1100px){
      .meals-grid{grid-template-columns:repeat(2,1fr)}
      .layout{grid-template-columns:220px 1fr 300px}
    }
    @media (max-width:860px){
      .meals-grid{grid-template-columns:1fr}
      .cards-row{grid-template-columns:1fr}
      .layout{grid-template-columns:1fr;gap:12px}
      .sidebar{position:fixed;left:0;top:0;bottom:0;width:260px;transform:translateX(-120%);z-index:3000;transition:transform .22s ease}
      .sidebar.open{transform:translateX(0)}
      .layout .rightpanel{order:3}
    }
    @media (max-width:520px){
      .top-search input{width:140px}
      .search-large input{width:160px}
      .profile-wrapper .avatar{width:36px;height:36px}
    }
    

    /* ----------------------------------------------
   Dark Mode Styles (GoMeal dark palette)
----------------------------------------------- */
body.dark {
  background: #121212;
  color: #f5f5f5;
}
body.dark .topbar {
  background: linear-gradient(180deg, rgba(30,30,30,0.95), rgba(30,30,30,0.9));
}
body.dark .sidebar {
  background: #1f3b28;
}
body.dark .main-card,
body.dark .rightpanel,
body.dark .meal-card,
body.dark .category-pill,
body.dark .modal {
  background: #1e1e1e;
  color: #eaeaea;
  box-shadow: 0 8px 20px rgba(0,0,0,0.4);
}
body.dark input,
body.dark button {
  color: #f1f1f1;
  background-color: #2a2a2a;
  border-color: rgba(255,255,255,0.08);
}
body.dark .add-small,
body.dark .checkout-btn {
  background: var(--green);
  color: #fff;
}
body.dark .nav-item.active {
  background: rgba(255,255,255,0.1);
}
body.dark .muted,
body.dark [style*="color:var(--muted)"] {
  color: #ccc !important;
}

  </style>
</head>
<body>
  <div class="container">

    <!-- Top bar -->
    <header class="topbar">
      <button id="burger" class="icon-btn" aria-label="Toggle menu"><i class="fa fa-bars"></i></button>
      <div class="brand">GoMeal<span>.</span></div>

      <div class="top-search">
        <input type="search" placeholder="What do you want to eat today?" aria-label="Search">
      </div>

      <div class="top-actions">
        <button id="darkToggle" class="icon-btn" aria-label="Toggle theme" title="Toggle theme">
          <i class="fa-regular fa-moon"></i>
        </button>
        <button class="icon-btn" aria-label="Notifications"><i class="fa-regular fa-bell"></i></button>

        <div class="profile-wrapper">
          <img id="userAvatar" class="avatar" src="https://i.pravatar.cc/40" alt="avatar">
          <button id="changePicBtn" class="icon-btn" title="Change picture"><i class="fa-solid fa-camera"></i></button>
          <input id="uploadPic" type="file" accept="image/*" style="display:none">
        </div>
      </div>
    </header>

    <!-- Main layout -->
    <div class="layout">

      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar" aria-label="Sidebar">
        <div class="profile">
          <img id="sidebarAvatar" src="https://i.pravatar.cc/56" alt="user" style="width:56px;height:56px;border-radius:10px;object-fit:cover">
          <div>
            <div style="font-weight:800" id="sidebarName">Hello, Guest</div>
            <div style="font-size:13px;color:rgba(255,255,255,0.9)">2 hrs until lunch</div>
          </div>
        </div>

        <nav class="nav" aria-label="Main">
          <button class="nav-item active"><i class="fa-solid fa-house"></i> Dashboard</button>
          <button class="nav-item"><i class="fa-solid fa-list"></i> Orders</button>
          <button class="nav-item"><i class="fa-solid fa-utensils"></i> Restaurants</button>
          <button class="nav-item"><i class="fa-solid fa-wallet"></i> Finance</button>
          <button class="nav-item"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
        </nav>

        <button class="start-order">Start new order</button>
      </aside>

      <!-- Center white main -->
      <main class="main-card">

        <div class="hero">
          <h2>Hello, <span id="userName">Guest</span> üëã</h2>
          <div class="search-large">
            <input type="search" placeholder="Search dishes, restaurants..." aria-label="Large search">
          </div>
        </div>

        <!-- category pills -->
        <div class="category-row" id="categoryRow">
          <div class="category-pill"><div class="icon">üçî</div><div><strong>Burger</strong><div style="font-size:12px;color:var(--muted)">12 restaurants</div></div></div>
          <div class="category-pill"><div class="icon">üçï</div><div><strong>Pizza</strong><div style="font-size:12px;color:var(--muted)">9 restaurants</div></div></div>
          <div class="category-pill"><div class="icon">ü•ó</div><div><strong>Salads</strong><div style="font-size:12px;color:var(--muted)">7 restaurants</div></div></div>
          <div class="category-pill"><div class="icon">üç∞</div><div><strong>Cakes</strong><div style="font-size:12px;color:var(--muted)">5 restaurants</div></div></div>
        </div>

        <!-- Top meals -->
        <div class="section-title">
          <h3 style="margin:0">Top meals this week</h3>
          <a href="#" style="color:var(--muted);font-size:14px">View all ‚Üí</a>
        </div>
        <div class="meals-grid" id="mealsGrid">
          <!-- meal cards (sample items) -->
          <div class="meal-card food-card" data-category="burgers">
            <img src="https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=800&q=60" alt="">
            <div><strong>Original Burger</strong></div>
            <div class="meal-meta"><div class="price">$4.92</div><button class="add-small">Add</button></div>
          </div>

          <div class="meal-card food-card" data-category="burgers">
            <img src="https://images.unsplash.com/photo-1605470207062-1c8f3a83e0ec?w=800&q=60" alt="">
            <div><strong>Special Burger</strong></div>
            <div class="meal-meta"><div class="price">$5.59</div><button class="add-small">Add</button></div>
          </div>

          <div class="meal-card food-card" data-category="pizza">
            <img src="https://images.unsplash.com/photo-1548365328-8d0b321419b9?w=800&q=60" alt="">
            <div><strong>Pepperoni Pizza</strong></div>
            <div class="meal-meta"><div class="price">$8.99</div><button class="add-small">Add</button></div>
          </div>
        </div>

        <!-- Favorite restaurants -->
        <div class="section-title" style="margin-top:18px">
          <h3 style="margin:0">Your favourite restaurants</h3>
          <a href="#" style="color:var(--muted);font-size:14px">View all ‚Üí</a>
        </div>
        <div class="cards-row">
          <div style="background:#fff;border-radius:12px;padding:12px;display:flex;gap:12px;align-items:center">
            <img src="https://images.unsplash.com/photo-1524182576060-9d6fefb0c7a5?w=800&q=60" style="width:120px;height:84px;object-fit:cover;border-radius:8px">
            <div>
              <strong>Best Restaurant</strong>
              <div style="font-size:13px;color:var(--muted)">4.9 ‚Ä¢ 200 reviews</div>
            </div>
          </div>

          <div style="background:#fff;border-radius:12px;padding:12px;display:flex;gap:12px;align-items:center">
            <img src="https://images.unsplash.com/photo-1544025162-d76694265947?w=800&q=60" style="width:120px;height:84px;object-fit:cover;border-radius:8px">
            <div>
              <strong>Great Eats</strong>
              <div style="font-size:13px;color:var(--muted)">4.8 ‚Ä¢ 150 reviews</div>
            </div>
          </div>
        </div>
      </main>

      <!-- Right panel (hidden until items added) -->
      <aside class="rightpanel" id="rightpanel" aria-label="My order" style="display:none">
        <div class="order-header">
          <div><strong>My Order</strong><div style="font-size:13px;color:var(--muted)">Take out</div></div>
          <button id="editOrder" style="background:transparent;border:none;color:var(--muted);cursor:pointer">Edit</button>
        </div>

        <ul class="order-list" id="orderList"></ul>

        <div class="totals">
          <div style="display:flex;justify-content:space-between"><span>Subtotal</span><strong id="subtotal">$0.00</strong></div>
          <div style="display:flex;justify-content:space-between"><span>Tax (10%)</span><strong id="tax">$0.00</strong></div>
          <div style="display:flex;justify-content:space-between;margin-top:6px"><span>Total</span><strong id="total">$0.00</strong></div>
        </div>

        <div style="display:flex;gap:8px;margin-top:10px">
          <button style="flex:1;border-radius:10px;padding:10px;border:1px solid rgba(15,23,36,0.06);background:#fff;cursor:pointer">Apply coupon</button>
          <button id="checkoutBtn" class="checkout-btn">Checkout</button>
        </div>
      </aside>

    </div>
  </div>

  <!-- Checkout Modal -->
  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-label="Order details">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">Order Details</h3>
        <button id="closeModal" style="background:transparent;border:none;font-size:20px;cursor:pointer">&times;</button>
      </div>

      <div class="modal-items" id="modalItems"></div>

      <div style="margin-top:12px">
        <div class="modal-row"><span>Subtotal</span><strong id="mSubtotal">$0.00</strong></div>
        <div class="modal-row"><span>Tax (10%)</span><strong id="mTax">$0.00</strong></div>
        <div class="modal-row"><span>Service</span><strong id="mService">$1.00</strong></div>
        <div class="modal-row" style="font-weight:800"><span>Total</span><strong id="mTotal">$0.00</strong></div>
      </div>

      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
        <button id="printBill" style="padding:8px 12px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer">Print Bills</button>
        <button id="confirmPay" style="padding:8px 12px;border-radius:8px;background:var(--green);color:#fff;border:none;cursor:pointer">Confirm & Pay</button>
      </div>
    </div>
  </div>

  <script>
/* ----------------------------------------------
   Dark Mode Toggle (keeps GoMeal color scheme)
----------------------------------------------- */
document.addEventListener('DOMContentLoaded', () => {
  const darkToggle = document.getElementById('darkToggle');
  const icon = darkToggle.querySelector('i');

  // Check saved theme
  const savedTheme = localStorage.getItem('gomeal_theme');
  if (savedTheme === 'dark') {
    document.body.classList.add('dark');
    icon.className = 'fa-solid fa-sun';
  }

  // Toggle theme
  darkToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    const isDark = document.body.classList.contains('dark');
    localStorage.setItem('gomeal_theme', isDark ? 'dark' : 'light');
    icon.className = isDark ? 'fa-solid fa-sun' : 'fa-regular fa-moon';
  });
});

  /****************************************************************
   * Dashboard JS
   * - sidebar burger
   * - profile upload + persistence
   * - categories & add-to-cart
   * - show/hide right panel when cart has items
   * - checkout modal with tax/service, confirm clears cart & deducts balance
   ****************************************************************/

  document.addEventListener('DOMContentLoaded', () => {
    // Elements
    const burger = document.getElementById('burger');
    const sidebar = document.getElementById('sidebar');
    const overlayDiv = document.createElement('div');
    overlayDiv.style.position = 'fixed';
    overlayDiv.style.inset = '0';
    overlayDiv.style.zIndex = '2500';
    overlayDiv.style.display = 'none';
    document.body.appendChild(overlayDiv);

    // Profile/avatar
    const userAvatar = document.getElementById('userAvatar');
    const sidebarAvatar = document.getElementById('sidebarAvatar');
    const uploadPic = document.getElementById('uploadPic');
    const changePicBtn = document.getElementById('changePicBtn');
    const userNameEl = document.getElementById('userName');
    const sidebarName = document.getElementById('sidebarName');
    const balanceEl = document.getElementById('balanceAmount') || null; // not present in this layout

    // Order elements
    const rightPanel = document.getElementById('rightpanel');
    const orderList = document.getElementById('orderList');
    const subtotalEl = document.getElementById('subtotal');
    const taxEl = document.getElementById('tax');
    const totalEl = document.getElementById('total');
    const checkoutBtn = document.getElementById('checkoutBtn');

    // Modal
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalItems = document.getElementById('modalItems');
    const mSubtotal = document.getElementById('mSubtotal');
    const mTax = document.getElementById('mTax');
    const mService = document.getElementById('mService');
    const mTotal = document.getElementById('mTotal');
    const closeModal = document.getElementById('closeModal');
    const printBill = document.getElementById('printBill');
    const confirmPay = document.getElementById('confirmPay');

    // constants
    const SERVICE_FEE = 1.00;
    const TAX_RATE = 0.10;

    // require logged-in user
    const loggedInUser = JSON.parse(sessionStorage.getItem('loggedInUser') || 'null');
    if (!loggedInUser) {
      // If you want to test without login, uncomment the demo user line below:
      // sessionStorage.setItem('loggedInUser', JSON.stringify({ name:'Demo', email:'demo@example.com' }));
      // location.reload();

      // otherwise redirect:
      window.location.href = 'login.html';
      return;
    }

    // show name
    if (userNameEl) userNameEl.textContent = loggedInUser.name || 'Guest';
    if (sidebarName) sidebarName.textContent = 'Hello, ' + (loggedInUser.name || 'Guest');

    // load avatar
    const savedAvatar = localStorage.getItem(`avatar_${loggedInUser.email}`);
    if (savedAvatar) { userAvatar.src = savedAvatar; sidebarAvatar.src = savedAvatar; }
    else if (loggedInUser.profilePic) { userAvatar.src = loggedInUser.profilePic; sidebarAvatar.src = loggedInUser.profilePic; }

    // load balance (default 0)
    const balKey = `balance_${loggedInUser.email}`;
    const savedBalance = parseFloat(localStorage.getItem(balKey) || '0');
    if (document.getElementById('balanceAmount')) document.getElementById('balanceAmount').textContent = `$${savedBalance.toFixed(2)}`;

    // avatar upload
    changePicBtn.addEventListener('click', () => uploadPic.click());
    uploadPic.addEventListener('change', function () {
      const f = this.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = e => {
        const data = e.target.result;
        userAvatar.src = data;
        sidebarAvatar.src = data;
        localStorage.setItem(`avatar_${loggedInUser.email}`, data);
        // update session user
        loggedInUser.profilePic = data;
        sessionStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
        alert('Profile picture updated');
      };
      reader.readAsDataURL(f);
    });

    // Sidebar burger toggle (mobile)
    function openSidebar(){ sidebar.classList.add('open'); sidebar.style.transform = 'translateX(0)'; overlayDiv.style.display = 'block'; overlayDiv.addEventListener('click', closeSidebar); }
    function closeSidebar(){ sidebar.classList.remove('open'); if (window.innerWidth < 860) sidebar.style.transform = 'translateX(-120%)'; overlayDiv.style.display = 'none'; overlayDiv.removeEventListener('click', closeSidebar); }
    burger.addEventListener('click', ()=>{ if (sidebar.classList.contains('open')) closeSidebar(); else openSidebar(); });
    window.addEventListener('resize', ()=>{ if (window.innerWidth >= 860){ sidebar.style.transform = 'translateX(0)'; overlayDiv.style.display='none'; } else { if (!sidebar.classList.contains('open')) sidebar.style.transform = 'translateX(-120%)'; } });

    // Orders: stored per user in localStorage key orders_<email>
    let cart = JSON.parse(localStorage.getItem(`orders_${loggedInUser.email}`) || '[]');

    // update UI function
    function renderCart(){
      if (!cart || cart.length === 0){ rightPanel.style.display = 'none'; return; }
      rightPanel.style.display = 'block';
      orderList.innerHTML = '';
      let subtotal = 0;
      cart.forEach((it, idx) => {
        subtotal += it.price * it.qty;
        const li = document.createElement('li');
        li.className = 'order-item';
        li.innerHTML = `
          <img src="${it.img}" alt="${it.name}">
          <div class="item-meta">
            <strong>${it.name}</strong><br>
            <small style="color:${'var(--muted)'}">$${it.price.toFixed(2)}</small>
          </div>
          <div class="item-controls">
            <button class="qty-btn minus" data-index="${idx}">-</button>
            <span style="min-width:22px;text-align:center">${it.qty}</span>
            <button class="qty-btn plus" data-index="${idx}">+</button>
          </div>
        `;
        orderList.appendChild(li);
      });

      const tax = subtotal * TAX_RATE;
      const total = subtotal + tax + SERVICE_FEE;
      subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
      taxEl.textContent = `$${tax.toFixed(2)}`;
      totalEl.textContent = `$${total.toFixed(2)}`;

      // attach qty handlers
      document.querySelectorAll('.qty-btn').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const i = parseInt(e.currentTarget.dataset.index);
          if (e.currentTarget.classList.contains('plus')) cart[i].qty++;
          else { cart[i].qty--; if (cart[i].qty <= 0) cart.splice(i,1); }
          localStorage.setItem(`orders_${loggedInUser.email}`, JSON.stringify(cart));
          renderCart();
        });
      });
    }

    // initial render
    renderCart();

    // Add-to-cart from meal cards
    document.querySelectorAll('.meal-card .add-small').forEach((btn, idx)=>{
      btn.addEventListener('click', (e)=>{
        const card = e.target.closest('.meal-card');
        const name = card.querySelector('strong').innerText.trim();
        const priceText = card.querySelector('.price').innerText.replace('$','').trim();
        const price = parseFloat(priceText) || 0;
        const img = card.querySelector('img').src;

        const found = cart.find(i => i.name === name);
        if (found) found.qty++;
        else cart.push({ name, price, img, qty: 1 });

        localStorage.setItem(`orders_${loggedInUser.email}`, JSON.stringify(cart));
        renderCart();
      });
    });

    // Checkout modal open
    checkoutBtn && checkoutBtn.addEventListener('click', ()=>{
      if (!cart || cart.length === 0) { alert('No items in order'); return; }
      // populate modal
      modalItems.innerHTML = '';
      let subtotal = 0;
      cart.forEach(it=>{
        const itemTotal = it.price * it.qty; subtotal += itemTotal;
        const div = document.createElement('div');
        div.style.display = 'flex'; div.style.justifyContent = 'space-between'; div.style.padding = '8px 0';
        div.innerHTML = `<div style="display:flex;gap:10px;align-items:center"><img src="${it.img}" style="width:56px;height:56px;border-radius:8px;object-fit:cover"><div><strong>${it.name}</strong><div style="font-size:13px;color:${'var(--muted)'}">$${it.price.toFixed(2)} √ó ${it.qty}</div></div></div><div style="font-weight:700">$${itemTotal.toFixed(2)}</div>`;
        modalItems.appendChild(div);
      });
      const tax = subtotal * TAX_RATE;
      const total = subtotal + tax + SERVICE_FEE;
      mSubtotal.textContent = `$${subtotal.toFixed(2)}`;
      mTax.textContent = `$${tax.toFixed(2)}`;
      mService.textContent = `$${SERVICE_FEE.toFixed(2)}`;
      mTotal.textContent = `$${total.toFixed(2)}`;

      modalBackdrop.classList.add('show');
      modalBackdrop.style.display = 'flex';
    });

    // modal events
    closeModal.addEventListener('click', ()=>{ modalBackdrop.classList.remove('show'); modalBackdrop.style.display='none'; });
    modalBackdrop.addEventListener('click', (e)=>{ if (e.target === modalBackdrop) { modalBackdrop.classList.remove('show'); modalBackdrop.style.display='none'; } });

    // print
    printBill.addEventListener('click', ()=> window.print());

    // confirm pay
    confirmPay.addEventListener('click', ()=>{
      // check logged user
      if (!loggedInUser) { alert('Please login'); return; }
      // compute total
      let subtotal = 0; cart.forEach(it=> subtotal += it.price * it.qty);
      const tax = subtotal * TAX_RATE;
      const total = subtotal + tax + SERVICE_FEE;

      // deduct from balance (if exists)
      const key = `balance_${loggedInUser.email}`; let bal = parseFloat(localStorage.getItem(key) || '0');
      bal = parseFloat((bal - total).toFixed(2));
      localStorage.setItem(key, bal.toFixed(2));
      // clear cart
      cart = []; localStorage.removeItem(`orders_${loggedInUser.email}`);
      renderCart();
      modalBackdrop.classList.remove('show'); modalBackdrop.style.display='none';
      alert('‚úÖ Order placed successfully!');
      // update displayed balance where applicable
      if (document.getElementById('balanceAmount')) document.getElementById('balanceAmount').textContent = `$${bal.toFixed(2)}`;
    });

    // nav logout (simple)
    document.querySelectorAll('.nav-item').forEach(btn=>{
      if (btn.innerText.trim().toLowerCase().includes('logout')){
        btn.addEventListener('click', ()=> {
          sessionStorage.removeItem('loggedInUser');
          // redirect to login
          window.location.href = 'login.html';
        });
      }
    });

  });
  </script>
</body>
</html>
